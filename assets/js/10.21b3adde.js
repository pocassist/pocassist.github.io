(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{361:function(t,s,a){t.exports=a.p+"assets/img/image-20210612201813017.0ce9b03e.png"},391:function(t,s,a){"use strict";a.r(s);var n=a(44),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"开发文档"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#开发文档"}},[t._v("#")]),t._v(" 开发文档")]),t._v(" "),n("h2",{attrs:{id:"_0x01-技术栈"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_0x01-技术栈"}},[t._v("#")]),t._v(" 0x01 技术栈")]),t._v(" "),n("table",[n("thead",[n("tr",[n("th",[t._v("需求")]),t._v(" "),n("th",[t._v("实现")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[t._v("命令行工具")]),t._v(" "),n("td",[t._v("github.com/urfave/cli/v2")])]),t._v(" "),n("tr",[n("td",[t._v("加载配置文件")]),t._v(" "),n("td",[t._v("github.com/spf13/viper")])]),t._v(" "),n("tr",[n("td",[t._v("服务端框架")]),t._v(" "),n("td",[t._v("github.com/gin-gonic/gin")])]),t._v(" "),n("tr",[n("td",[t._v("身份认证 jwt")]),t._v(" "),n("td",[t._v("github.com/dgrijalva/jwt-go")])]),t._v(" "),n("tr",[n("td",[t._v("orm")]),t._v(" "),n("td",[t._v("gorm.io/gorm")])]),t._v(" "),n("tr",[n("td",[t._v("规则表达式")]),t._v(" "),n("td",[t._v("github.com/google/cel-go/cel")])]),t._v(" "),n("tr",[n("td",[t._v("sqlite数据库驱动")]),t._v(" "),n("td",[t._v("gorm.io/driver/sqlite")])]),t._v(" "),n("tr",[n("td",[t._v("mysql数据库驱动")]),t._v(" "),n("td",[t._v("gorm.io/driver/mysql")])]),t._v(" "),n("tr",[n("td",[t._v("日志")]),t._v(" "),n("td",[t._v("go.uber.org/zap")])]),t._v(" "),n("tr",[n("td",[t._v("http请求")]),t._v(" "),n("td",[t._v("github.com/valyala/fasthttp")])]),t._v(" "),n("tr",[n("td",[t._v("限速")]),t._v(" "),n("td",[t._v("golang.org/x/time/rate")])]),t._v(" "),n("tr",[n("td",[t._v("并发控制")]),t._v(" "),n("td",[t._v("sync.WaitGroup")])]),t._v(" "),n("tr",[n("td",[t._v("swag")]),t._v(" "),n("td",[t._v("github.com/swaggo/gin-swagger")])]),t._v(" "),n("tr",[n("td",[t._v("前端")]),t._v(" "),n("td",[n("a",{attrs:{href:"https://antd-course.ulivz.com/intro.html#%E5%BC%80%E5%A7%8B%E5%AD%A6%E4%B9%A0",target:"_blank",rel:"noopener noreferrer"}},[t._v("antd"),n("OutboundLink")],1)])]),t._v(" "),n("tr",[n("td",[t._v("静态资源打包至go二进制")]),t._v(" "),n("td",[t._v("github.com/elazarl/go-bindata-assetfs")])])])]),t._v(" "),n("h2",{attrs:{id:"_0x02-项目布局"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_0x02-项目布局"}},[t._v("#")]),t._v(" 0x02 项目布局")]),t._v(" "),n("p",[t._v("pocassist 遵循 Golang 应⽤程序项⽬的"),n("a",{attrs:{href:"https://github.com/golang-standards/project-layout/blob/master/README_zh-CN.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("基本布局"),n("OutboundLink")],1)]),t._v(" "),n("p",[t._v("在二次开发前建议先阅读 "),n("a",{attrs:{href:"https://github.com/golang-standards/project-layout/blob/master/README_zh-CN.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("Go项目标准布局"),n("OutboundLink")],1)]),t._v(" "),n("h2",{attrs:{id:"_0x03-cmd"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_0x03-cmd"}},[t._v("#")]),t._v(" 0x03 cmd")]),t._v(" "),n("p",[n("code",[t._v("/cmd")]),t._v(" 是项目入口")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("InitAll")]),t._v("方法在项目启动时最先执行：加载配置以及各个包的初始化工作")]),t._v(" "),n("li",[n("code",[t._v("HotConf")]),t._v("方法通过"),n("code",[t._v("viper")]),t._v("实现了配置文件实时监控，配置文件发生变更之后会重新"),n("code",[t._v("InitAll")]),t._v("，实现热加载")])]),t._v(" "),n("p",[n("strong",[t._v("目录结构")])]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("└── pocassist.go\t入口函数 加载全局配置 初始化\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("h2",{attrs:{id:"_0x04-api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_0x04-api"}},[t._v("#")]),t._v(" 0x04 api")]),t._v(" "),n("p",[n("code",[t._v("/api")]),t._v(" 是 api 框架，基于 gin 开发。")]),t._v(" "),n("p",[t._v("为方便开发过程测试接口，源码中每个接口均编写了详细的注释。同时，当config.yaml 中 "),n("code",[t._v('run_mode: "debug"')]),t._v("（debug模式）下将开启swagger。访问：")]),t._v(" "),n("p",[t._v("http://127.0.0.1:1231/swagger/index.html")]),t._v(" "),n("p",[n("strong",[t._v("目录结构")])]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("├── middleware\n│   └── jwt\n│       └── jwt.go\t\t\t\tjwt身份验证\n├── msg\n│   └── msg.go\t\t\t\t\t定义api数据交互格式\n└── routers\n    ├── route.go\t\t\t\t注册路由\n    ├── ui.go\t\t\t\t\t加载go-bindata-assetfs打包的静态页面\n    └── v1\n        ├── auth\n        │   └── auth.go\t\t\t登录/登出/改密/个人详情\n        ├── plugin\n        │   └── plugin.go\t\tpoc 增/删/改/查/列表/详情/运行（单个）\n        ├── scan\n        │   ├── result\n        │   │   └── result.go\tpoc批量运行结果\n        │   ├── scan\n        │   │   └── scan.go\t\tpoc批量运行。支持定义三种目标：单个url / 单个请求报文（文件形式上传） / url列表（文件形式上传）\n        │   └── task\n        │       └── task.go\t\t任务状态\n        ├── vulnerability\n        │   └── vulnerability.go\t漏洞详情 增/删/改/查/列表/详情\n        └── webapp\n            └── webapp.go\t\t漏洞详情中的”影响组件“ 增/列表\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br")])]),n("h2",{attrs:{id:"_0x05-pkg"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_0x05-pkg"}},[t._v("#")]),t._v(" 0x05 pkg")]),t._v(" "),n("p",[n("code",[t._v("/pkg")]),t._v(" 是整个项目的工具包。其中包含：")]),t._v(" "),n("ul",[n("li",[t._v("cel表达式实现：cel变量注入、cel方法注入")]),t._v(" "),n("li",[t._v("配置文件：配置文件的加载、默认配置文件的生成")]),t._v(" "),n("li",[t._v("数据库：orm model")]),t._v(" "),n("li",[t._v("文件操作")])]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("├── cel\n│   ├── cel.go\t\t\t\tcel表达式：注入函数、表达式计算\n│   ├── proto\n│   │   ├── http.pb.go\t\t注入到cel中的类型（go-cel要求必须为protobuf格式）\n│   │   └── http.proto\t\t生成http.pb.go的原始proto文件\n│   └── reverse\n│       └── reverse.go\t\t实现cel中的Reverse（反连平台，dnslog/weblog）变量和方法\n├── conf\n│   ├── config.go\t\t\t定义config结构体，Setup方法将加载配置文件至GlobalConfig。当前目录没有配置文件时，将创建默认的配置文件\n│   └── default.go\t\t\t默认配置文件内容\n├── db\n│   ├── auth.go\t\t\t\t身份认证相关的数据库操作\n│   ├── conn.go\t\t\t\t数据库连接，当配置了sqlite时优先使用sqlite\n│   ├── plugin.go\t\t\tpoc相关的数据库操作\n│   ├── scanResult.go\t\t扫描结果相关的数据库操作\n│   ├── scanTask.go\t\t\t扫描任务状态相关的数据库操作\n│   ├── vulnerability.go\t漏洞描述相关的数据库操作\n│   └── webapp.go\t\t\t漏洞描述中所属组件相关的数据库操作\n├── file\n│   └── file.go\t\t\t\t处理文件：处理批量扫描时上传的文件\n├── logging\n│   └── log.go\t\t\t\t处理日志\n└── util\n    ├── jwt.go\t\t\t\t生成和解析jwt token\n    ├── rand.go\t\t\t\t随机数 随机字符\n    ├── request.go\t\t\tfasthttp请求与响应\n    ├── result.go\t\t\t定义poc检测结果格式\n    ├── tcp.go\t\t\t\ttcp请求与响应\n    └── util.go\t\t\t\tutil初始化函数\n\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br")])]),n("p",[t._v("如何生成protobuf：")]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("go get github.com/golang/protobuf\ncd /pkg/cel/proto\nprotoc --go_out=. http.proto\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br")])]),n("h2",{attrs:{id:"_0x06-poc"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_0x06-poc"}},[t._v("#")]),t._v(" 0x06 poc")]),t._v(" "),n("p",[n("img",{attrs:{src:a(361),alt:"image-20210612201813017"}})]),t._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("├── rule\n│   ├── handle.go\t\t\t  单个poc的流程控制\n│   ├── controller.go\t\tcel表达式规则运行controller\n│   ├── run.go\t\t\t    单个poc运行逻辑\n│   ├── parallel.go\t\t\t并发控制\n│   ├── rule.go\t\t\t    poc model 以及 set/search处理\n│   ├── cel.go\t\t\t\t  cel控制器\n│   └── request.go\t\t\t原始请求/构造的请求控制器\n└── scripts\n    ├── poc-go-memcached-unauth.go\t\tdemo脚本1\n    ├── poc-go-tomcat-weak-pass.go\t\tdemo脚本2\n    └── scripts.go\t\t\t\t\t\t脚本注册、脚本调度\n\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br")])]),n("p",[t._v("面向web的 poc 框架占用的内存资源绝大多数来源于开辟"),n("code",[t._v("请求")]),t._v("和"),n("code",[t._v("响应")]),t._v("。目前常见的 poc 框架并发都是在"),n("code",[t._v("同时运行poc数量")]),t._v("控制的。这里就会产生几个问题：")]),t._v(" "),n("ul",[n("li",[t._v("单纯控制 poc 并发，在每个 poc 内部是面向过程的。在一个 poc 结束之前，这个 poc 所占用的资源不会被立即释放，就可能造成资源浪费。例如："),n("strong",[t._v("一个 poc 通常会发多个请求，而且要对每个请求的响应进行解析。每一个请求和响应在使用之后都进行初始化，下一个请求/响应复用这块内存，是不是就降低了内存开销。")])]),t._v(" "),n("li",[t._v("单纯控制 poc 并发，占用资源的总量是无法预估的，容易造成崩溃。")]),t._v(" "),n("li",[n("strong",[t._v("我们知道发送一个请求是很快的，而解析响应的开销要多的多。实际上解析响应时，已经不再需要request对象了，这里也会有资源浪费。")])])]),t._v(" "),n("p",[t._v("go 语言中有一个神奇的对象池 "),n("code",[t._v("sync.Pool")]),t._v("。神奇的地方在于，一开始这个池子会初始化一些对象供你使用，如果不够了呢，自己会通过new产生一些，当你放回去了之后这些对象会被别人进行复用。")]),t._v(" "),n("p",[t._v("所以：")]),t._v(" "),n("p",[t._v("pocassist 把使用频率高的对象（如poc对象、请求、响应、响应处理等）均使用对象池 "),n("code",[t._v("sync.Pool")]),t._v(" 进行管理，大幅度减少对象的创建和回收的时间，内存使用效率极大提高")]),t._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),n("p",[t._v("poc/rule/controller.go 将controller 用 "),n("code",[t._v("sync.Pool")]),t._v("管理")]),t._v(" "),n("p",[t._v("pkg/util/requests 将 request / response / 响应处理 用 "),n("code",[t._v("sync.Pool")]),t._v("管理")])])])}),[],!1,null,null,null);s.default=e.exports}}]);