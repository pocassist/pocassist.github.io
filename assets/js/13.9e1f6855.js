(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{394:function(s,a,t){"use strict";t.r(a);var e=t(44),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"运行模式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行模式"}},[s._v("#")]),s._v(" 运行模式")]),s._v(" "),t("h2",{attrs:{id:"_0x01-后端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_0x01-后端"}},[s._v("#")]),s._v(" 0x01 后端")]),s._v(" "),t("h3",{attrs:{id:"_1-1-环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-环境"}},[s._v("#")]),s._v(" 1-1 环境")]),s._v(" "),t("p",[s._v("go 1.13.3")]),s._v(" "),t("h3",{attrs:{id:"_1-2-源码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-源码"}},[s._v("#")]),s._v(" 1-2 源码")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("git clone https://github.com/jweny/pocassist.git\ncd pocassist\ngo build\n./pocassist\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"_1-3-swagger配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-swagger配置"}},[s._v("#")]),s._v(" 1-3 swagger配置")]),s._v(" "),t("p",[s._v("开发过程中，可以使用 swagger 测试 api 是否正常运行")]),s._v(" "),t("p",[s._v("gin-swagger 的配置可参考 "),t("a",{attrs:{href:"https://hawli.cn/2018/04/09/swag%E6%B3%A8%E8%A7%A3%E6%8C%87%E5%8D%97/",target:"_blank",rel:"noopener noreferrer"}},[s._v("教程"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("或者参考我已经写好的 swagger 注解（每个 api 方法都有）")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),t("p",[s._v("当 config.yaml 中"),t("code",[s._v('run_mode: "debug"')]),s._v("时，pocassist 将以debug方式启动，届时将自动启用swagger")]),s._v(" "),t("p",[s._v("访问地址"),t("code",[s._v("http://127.0.0.1:1231/swagger/index.html")])])]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),t("p",[s._v("swagger 在 gin 中注册路由的逻辑请查看"),t("code",[s._v("api/routers/router.go:InitRouter")]),s._v(" 方法")])]),s._v(" "),t("p",[s._v("当你开发了新的接口，或者更改了当前注解，可通过以下方式更新：")]),s._v(" "),t("ol",[t("li",[t("code",[s._v("cd pocassist")])]),s._v(" "),t("li",[s._v("安装 swag "),t("code",[s._v("go get -u github.com/swaggo/swag/cmd/swag")])]),s._v(" "),t("li",[s._v("初始化 swag "),t("code",[s._v("swag init")]),s._v("，初始化完成之后将在当前目录创建一个 "),t("code",[s._v("docs")]),s._v(" 目录，目录中有生成 go文件、json文件、yaml文件")]),s._v(" "),t("li",[t("code",[s._v("go build")]),s._v("编译成go二进制")])]),s._v(" "),t("h2",{attrs:{id:"_0x02-前端"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_0x02-前端"}},[s._v("#")]),s._v(" 0x02 前端")]),s._v(" "),t("h3",{attrs:{id:"_2-1-环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-环境"}},[s._v("#")]),s._v(" 2-1 环境")]),s._v(" "),t("p",[s._v("安装 yarn")]),s._v(" "),t("h3",{attrs:{id:"_2-2-源码"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-源码"}},[s._v("#")]),s._v(" 2-2 源码")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("git clone https://github.com/jweny/pocassistweb.git\ncd pocassistweb\n# 本地运行\nyarn start\n# 打包成静态文件\nyarn build\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"_2-3-静态文件打包至go二进制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-静态文件打包至go二进制"}},[s._v("#")]),s._v(" 2-3 静态文件打包至go二进制")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("编辑前端源码，本地运行通过")])]),s._v(" "),t("li",[t("p",[s._v("打包， "),t("code",[s._v("yarn build")])])]),s._v(" "),t("li",[t("p",[s._v("将生成的 build 文件夹 copy 至 pocassist/web/ ， 此时 build 文件夹的路径为 "),t("code",[s._v("pocassist/web/build")])])]),s._v(" "),t("li",[t("p",[s._v("安装"),t("a",{attrs:{href:"https://github.com/elazarl/go-bindata-assetfs",target:"_blank",rel:"noopener noreferrer"}},[s._v("go-bindata-assetfs"),t("OutboundLink")],1),s._v("，安装方式"),t("a",{attrs:{href:"https://github.com/elazarl/go-bindata-assetfs",target:"_blank",rel:"noopener noreferrer"}},[s._v("点击"),t("OutboundLink")],1)])]),s._v(" "),t("li",[t("p",[s._v("将静态文件转为"),t("code",[s._v("bindata.go")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("cd pocassist\ngo-bindata-assetfs -o web/bindata.go -pkg web web/build/...\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])])]),s._v(" "),t("li",[t("p",[s._v("此时会生成一个"),t("code",[s._v("pocassist/web/bindata.go")]),s._v("文件")])]),s._v(" "),t("li",[t("p",[t("code",[s._v("go build")]),s._v("编译成go二进制")])])]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("TIP")]),s._v(" "),t("p",[s._v("gin 加载 bindata.go 的逻辑在 "),t("code",[s._v("/api/ui.go")]),s._v("中。使用 goland 查看这段代码是会被标红：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("Asset:     web.Asset,\nAssetDir:  web.AssetDir,\nAssetInfo: web.AssetInfo,\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("原因为"),t("code",[s._v("bindata.go")]),s._v("文件太大，goland 不会做代码分析关联，不影响正常编译运行。")])]),s._v(" "),t("h3",{attrs:{id:"_2-4-前后端分离部署-nginx"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-前后端分离部署-nginx"}},[s._v("#")]),s._v(" 2-4 前后端分离部署(nginx)")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("编辑前端源码，本地运行通过")])]),s._v(" "),t("li",[t("p",[s._v("打包。"),t("code",[s._v("yarn build")])])]),s._v(" "),t("li",[t("p",[s._v("将  build 文件夹 上传至服务器")])]),s._v(" "),t("li",[t("p",[s._v("安装 nginx")])]),s._v(" "),t("li",[t("p",[s._v("修改 nginx.conf 反向代理后端")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("pstream pocassistAPI {\n\t\t\t\t# pocassist api 端口\n        server 127.0.0.1:1231;\n    }\nserver {\n        listen       80;\n        location / {\n        \t\t# 配置build文件夹路径\n            root /opt/pocassistWEB/build/;\n        }\n        location /api/ {\n            proxy_pass http://pocassistAPI/api/;\n        }\n        error_page 404 /404.html;\n            location = /40x.html {\n        }\n        error_page 500 502 503 504 /50x.html;\n            location = /50x.html {\n        }\n    }\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])])])])])}),[],!1,null,null,null);a.default=n.exports}}]);